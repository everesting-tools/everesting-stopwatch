<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ–∫—É–Ω–¥–æ–º–µ—Ä –¥–ª—è —ç–≤–µ—Ä–µ—Å—Ç–∏–Ω–≥–∞</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>–°–µ–∫—É–Ω–¥–æ–º–µ—Ä –¥–ª—è —ç–≤–µ—Ä–µ—Å—Ç–∏–Ω–≥–∞</h1>
    
    <div class="instructions">
        <button class="toggle-instructions"></button>
        <div class="instructions-content">
            <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h3>
            <ul>
                <li><strong>–ü—É—Å–∫/–∫—Ä—É–≥</strong> - –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Ç—Å—á—ë—Ç. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–∂–∞—Ç–∏—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç –≤—Ä–µ–º—è –∫—Ä—É–≥–∞ –∏ –Ω–∞—á–∏–Ω–∞—é—Ç –Ω–æ–≤—ã–π –∫—Ä—É–≥</li>
                <li><strong>–ü–∞—É–∑–∞</strong> - –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç –ø–∞—É–∑—É. –í—Ä–µ–º—è –ø–∞—É–∑—ã –≤—Ö–æ–¥–∏—Ç –≤ –æ–±—â–µ–µ –≤—Ä–µ–º—è –∫—Ä—É–≥–∞, –Ω–æ –æ—Ç—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ –∫—Ä—É–≥–∞ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è</li>
                <li><strong>–§–∏–Ω–∏—à</strong> - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ —Å–µ–∫—É–Ω–¥–æ–º–µ—Ä—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–≥ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Ç—Ä–æ–π–Ω—ã–º –Ω–∞–∂–∞—Ç–∏–µ–º)</li>
                <li><strong>–°–±—Ä–æ—Å</strong> - –æ—á–∏—â–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Ç—Ä–æ–π–Ω—ã–º –Ω–∞–∂–∞—Ç–∏–µ–º –∫–æ–≥–¥–∞ —Å–µ–∫—É–Ω–¥–æ–º–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)</li>
            </ul>
            <p><em>–ü–æ—Å–ª–µ —Ñ–∏–Ω–∏—à–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ñ–∞–π–ª —Å –ª–æ–≥–æ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ UTF-8</em></p>
        </div>
    </div>
    
    <div class="timer-display">
        <div>–û–±—â–µ–µ –≤—Ä–µ–º—è: <span id="total-time">00:00:00</span></div>
        <div>–¢–µ–∫—É—â–∏–π –∫—Ä—É–≥: <span id="lap-time">00:00:00</span></div>
        <div>–ü–∞—É–∑–∞: <span id="pause-time">00:00:00</span></div>
    </div>
    
    <div class="status-indicator">
        <div class="status-item">
            <div class="status-dot stopped" id="total-status"></div>
            <span>–û–±—â–µ–µ –≤—Ä–µ–º—è</span>
        </div>
        <div class="status-item">
            <div class="status-dot stopped" id="lap-status"></div>
            <span>–¢–µ–∫—É—â–∏–π –∫—Ä—É–≥</span>
        </div>
        <div class="status-item">
            <div class="status-dot stopped" id="pause-status"></div>
            <span>–ü–∞—É–∑–∞</span>
        </div>
    </div>
    
    <div class="controls">
        <button id="btn-start" class="btn-start">–ü—É—Å–∫/–∫—Ä—É–≥</button>
        <button id="btn-pause" class="btn-pause" disabled>–ü–∞—É–∑–∞</button>
        <button id="btn-finish" class="btn-finish" disabled>–§–∏–Ω–∏—à</button>
        <button id="btn-reset" class="btn-reset" disabled>–°–±—Ä–æ—Å</button>
    </div>
    
    <div id="finish-indicator" class="action-indicator" style="display: none;">
        –ù–∞–∂–º–∏—Ç–µ –µ—â–µ <span id="finish-count">2</span> —Ä–∞–∑–∞ –¥–ª—è —Ñ–∏–Ω–∏—à–∞
    </div>
    
    <div id="reset-indicator" class="action-indicator" style="display: none;">
        –ù–∞–∂–º–∏—Ç–µ –µ—â–µ <span id="reset-count">2</span> —Ä–∞–∑–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞
    </div>
    
    <div class="table-container">
        <table id="results-table">
            <thead>
                <tr>
                    <th>–ö—Ä—É–≥</th>
                    <th>–í—Ä–µ–º—è –∫—Ä—É–≥–∞</th>
                    <th>–ü–∞—É–∑–∞</th>
                    <th>–ß–∏—Å—Ç–æ–µ –≤—Ä–µ–º—è</th>
                    <th>–û–±—â–µ–µ –≤—Ä–µ–º—è</th>
                </tr>
            </thead>
            <tbody id="results-body">
                <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </tbody>
        </table>
    </div>

    <div id="summary" class="summary" style="display: none;">
        <h2>–ò—Ç–æ–≥–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h2>
        <div class="summary-grid">
            <div class="summary-item">
                <span class="summary-label">–û–±—â–µ–µ –≤—Ä–µ–º—è:</span>
                <span class="summary-value" id="summary-total-time">00:00:00</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—É–≥–æ–≤:</span>
                <span class="summary-value" id="summary-lap-count">0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∫—Ä—É–≥–∞:</span>
                <span class="summary-value" id="summary-avg-lap">00:00:00</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">–°—Ä–µ–¥–Ω–µ–µ —á–∏—Å—Ç–æ–µ –≤—Ä–µ–º—è:</span>
                <span class="summary-value" id="summary-avg-net">00:00:00</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">–ú–∞–∫—Å. –≤—Ä–µ–º—è –∫—Ä—É–≥–∞:</span>
                <span class="summary-value" id="summary-max-lap">00:00:00</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">–ú–∏–Ω. –≤—Ä–µ–º—è –∫—Ä—É–≥–∞:</span>
                <span class="summary-value" id="summary-min-lap">00:00:00</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—É–∑:</span>
                <span class="summary-value" id="summary-pause-count">0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">–°—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è –ø–∞—É–∑:</span>
                <span class="summary-value" id="summary-total-pause">00:00:00</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">–ß–∏—Å—Ç–æ–µ –æ–±—â–µ–µ –≤—Ä–µ–º—è:</span>
                <span class="summary-value" id="summary-net-total">00:00:00</span>
            </div>
        </div>
    </div>

    <script>
        // ==================================================
        // –°–µ–∫—É–Ω–¥–æ–º–µ—Ä –¥–ª—è —ç–≤–µ—Ä–µ—Å—Ç–∏–Ω–≥–∞
        // –ê–≤—Ç–æ—Ä: AI Assistant
        // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 2024-01-15
        // –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è: 14:30
        // –í–µ—Ä—Å–∏—è: 2.0
        // ==================================================
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
        let startTime = 0;
        let lapStartTime = 0;
        let pauseStartTime = 0;
        let totalElapsed = 0;
        let lapElapsed = 0;
        let pauseElapsed = 0;
        let isRunning = false;
        let isPaused = false;
        let lapCount = 0;
        
        // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∫—Ä—É–≥–∞—Ö
        let lapsData = [];
        
        // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π
        let actionLogs = [];
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
        let totalInterval;
        let lapInterval;
        let pauseInterval;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å —Ç—Ä–æ–π–Ω—ã–º –Ω–∞–∂–∞—Ç–∏–µ–º
        let finishClickCount = 0;
        let finishClickTimer;
        let finishIndicatorTimeout;
        
        let resetClickCount = 0;
        let resetClickTimer;
        let resetIndicatorTimeout;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const totalTimeDisplay = document.getElementById('total-time');
        const lapTimeDisplay = document.getElementById('lap-time');
        const pauseTimeDisplay = document.getElementById('pause-time');
        const btnStart = document.getElementById('btn-start');
        const btnPause = document.getElementById('btn-pause');
        const btnFinish = document.getElementById('btn-finish');
        const btnReset = document.getElementById('btn-reset');
        const resultsBody = document.getElementById('results-body');
        const totalStatus = document.getElementById('total-status');
        const lapStatus = document.getElementById('lap-status');
        const pauseStatus = document.getElementById('pause-status');
        const finishIndicator = document.getElementById('finish-indicator');
        const finishCountDisplay = document.getElementById('finish-count');
        const resetIndicator = document.getElementById('reset-indicator');
        const resetCountDisplay = document.getElementById('reset-count');
        const summary = document.getElementById('summary');
        const instructions = document.querySelector('.instructions');
        const toggleInstructions = document.querySelector('.toggle-instructions');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏—Ç–æ–≥–æ–≤
        const summaryTotalTime = document.getElementById('summary-total-time');
        const summaryLapCount = document.getElementById('summary-lap-count');
        const summaryAvgLap = document.getElementById('summary-avg-lap');
        const summaryAvgNet = document.getElementById('summary-avg-net');
        const summaryMaxLap = document.getElementById('summary-max-lap');
        const summaryMinLap = document.getElementById('summary-min-lap');
        const summaryPauseCount = document.getElementById('summary-pause-count');
        const summaryTotalPause = document.getElementById('summary-total-pause');
        const summaryNetTotal = document.getElementById('summary-net-total');
        
        // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤ —á—á:–º–º:—Å—Å (–±–µ–∑ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥)
        function formatTime(ms) {
            const hours = Math.floor(ms / 3600000);
            const minutes = Math.floor((ms % 3600000) / 60000);
            const seconds = Math.floor((ms % 60000) / 1000);
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ª–æ–≥–æ–≤
        function formatDateTime(date) {
            return date.toLocaleString('ru-RU', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥
        function addLog(action, details = '') {
            const logEntry = {
                timestamp: new Date(),
                action: action,
                details: details,
                totalTime: totalElapsed,
                lapTime: lapElapsed,
                pauseTime: pauseElapsed,
                lapCount: lapCount,
                isPaused: isPaused
            };
            
            actionLogs.push(logEntry);
            console.log(`[${formatDateTime(logEntry.timestamp)}] ${action} ${details}`);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏—Å–ø–ª–µ–µ–≤ –≤—Ä–µ–º–µ–Ω–∏
        function updateDisplays() {
            const now = Date.now();
            
            if (isRunning) {
                // –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—Å–µ–≥–¥–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
                totalElapsed = now - startTime;
                
                // –í—Ä–µ–º—è –∫—Ä—É–≥–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø–∞—É–∑—ã
                lapElapsed = now - lapStartTime;
                
                // –í—Ä–µ–º—è –ø–∞—É–∑—ã —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –ø–∞—É–∑—ã
                if (isPaused) {
                    pauseElapsed = now - pauseStartTime;
                }
            }
            
            totalTimeDisplay.textContent = formatTime(totalElapsed);
            lapTimeDisplay.textContent = formatTime(lapElapsed);
            pauseTimeDisplay.textContent = formatTime(pauseElapsed);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Å–µ–∫—É–Ω–¥–æ–º–µ—Ä–æ–≤
        function startTimers() {
            const now = Date.now();
            
            if (!isRunning) {
                // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
                startTime = now;
                lapStartTime = now;
                isRunning = true;
                
                // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
                addLog('–°–¢–ê–†–¢', '–ó–∞–ø—É—Å–∫ —Å–µ–∫—É–Ω–¥–æ–º–µ—Ä–∞');
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
                totalStatus.className = 'status-dot running';
                lapStatus.className = 'status-dot running';
                
                // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫
                btnPause.disabled = false;
                btnFinish.disabled = false;
                btnReset.disabled = false;
                btnStart.textContent = '–ö—Ä—É–≥';
                btnStart.classList.add('active');
                btnPause.classList.add('active');
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∏—Ç–æ–≥–∏, –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –ø–æ–∫–∞–∑–∞–Ω—ã
                summary.style.display = 'none';
            } else {
                // –§–∏–∫—Å–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∫—Ä—É–≥–∞
                recordLap();
                
                // –°–±—Ä–æ—Å –≤—Ä–µ–º–µ–Ω–∏ –∫—Ä—É–≥–∞
                lapStartTime = now;
                lapElapsed = 0;
                pauseElapsed = 0;
                
                // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
                addLog('–ö–†–£–ì', `–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –∫—Ä—É–≥ ‚Ññ${lapCount + 1}`);
            }
            
            // –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            clearInterval(totalInterval);
            clearInterval(lapInterval);
            totalInterval = setInterval(updateDisplays, 100);
            lapInterval = setInterval(updateDisplays, 100);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–∞—É–∑—ã/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        function togglePause() {
            const now = Date.now();
            
            if (!isPaused) {
                // –í–∫–ª—é—á–µ–Ω–∏–µ –ø–∞—É–∑—ã
                isPaused = true;
                pauseStartTime = now;
                pauseStatus.className = 'status-dot paused';
                
                // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
                addLog('–ü–ê–£–ó–ê', '–í–∫–ª—é—á–µ–Ω–∞ –ø–∞—É–∑–∞');
                
                // –ó–∞–ø—É—Å–∫ —Å–µ–∫—É–Ω–¥–æ–º–µ—Ä–∞ –ø–∞—É–∑—ã
                clearInterval(pauseInterval);
                pauseInterval = setInterval(updateDisplays, 100);
            } else {
                // –í—ã–∫–ª—é—á–µ–Ω–∏–µ –ø–∞—É–∑—ã
                isPaused = false;
                pauseElapsed += now - pauseStartTime;
                pauseStatus.className = 'status-dot stopped';
                
                // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
                addLog('–ü–ê–£–ó–ê', '–í—ã–∫–ª—é—á–µ–Ω–∞ –ø–∞—É–∑–∞');
                
                // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ–∫—É–Ω–¥–æ–º–µ—Ä–∞ –ø–∞—É–∑—ã
                clearInterval(pauseInterval);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –∫—Ä—É–≥–∞
        function recordLap() {
            const now = Date.now();
            lapCount++;
            
            // –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∫—Ä—É–≥–∞ —Å –ø–∞—É–∑–æ–π –∏ –±–µ–∑
            const lapTimeWithPause = now - lapStartTime;
            const netLapTime = lapTimeWithPause - pauseElapsed;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫—Ä—É–≥–∞
            const lapData = {
                lapNumber: lapCount,
                lapTime: lapTimeWithPause,
                pauseTime: pauseElapsed,
                netTime: netLapTime,
                totalTime: now - startTime,
                timestamp: new Date()
            };
            
            lapsData.push(lapData);
            
            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
            addLog('–§–ò–ö–°–ê–¶–ò–Ø –ö–†–£–ì–ê', 
                `–ö—Ä—É–≥ ‚Ññ${lapCount}: –≤—Ä–µ–º—è=${formatTime(lapTimeWithPause)}, –ø–∞—É–∑–∞=${formatTime(pauseElapsed)}, —á–∏—Å—Ç–æ–µ=${formatTime(netLapTime)}`);
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—É
            const newRow = resultsBody.insertRow();
            newRow.innerHTML = `
                <td>${lapCount}</td>
                <td class="lap-time">${formatTime(lapTimeWithPause)}</td>
                <td class="pause-time">${formatTime(pauseElapsed)}</td>
                <td class="net-time">${formatTime(netLapTime)}</td>
                <td class="total-time">${formatTime(now - startTime)}</td>
            `;
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏
            resultsBody.parentElement.scrollTop = resultsBody.parentElement.scrollHeight;
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤
        function calculateSummary() {
            if (lapsData.length === 0) return;
            
            // –û–±—â–µ–µ –≤—Ä–µ–º—è
            const totalTime = lapsData[lapsData.length - 1].totalTime;
            
            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—É–≥–æ–≤
            const lapCount = lapsData.length;
            
            // –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∫—Ä—É–≥–∞
            const totalLapTime = lapsData.reduce((sum, lap) => sum + lap.lapTime, 0);
            const avgLapTime = totalLapTime / lapCount;
            
            // –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å—Ç–æ–µ –≤—Ä–µ–º—è
            const totalNetTime = lapsData.reduce((sum, lap) => sum + lap.netTime, 0);
            const avgNetTime = totalNetTime / lapCount;
            
            // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∫—Ä—É–≥–∞
            const lapTimes = lapsData.map(lap => lap.lapTime);
            const maxLapTime = Math.max(...lapTimes);
            const minLapTime = Math.min(...lapTimes);
            
            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—É–∑ (–∫—Ä—É–≥–∏ —Å –≤—Ä–µ–º–µ–Ω–µ–º –ø–∞—É–∑—ã > 0)
            const pauseCount = lapsData.filter(lap => lap.pauseTime > 0).length;
            
            // –°—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è –ø–∞—É–∑
            const totalPauseTime = lapsData.reduce((sum, lap) => sum + lap.pauseTime, 0);
            
            // –ß–∏—Å—Ç–æ–µ –æ–±—â–µ–µ –≤—Ä–µ–º—è
            const netTotalTime = totalTime - totalPauseTime;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏—Ç–æ–≥–æ–≤
            summaryTotalTime.textContent = formatTime(totalTime);
            summaryLapCount.textContent = lapCount;
            summaryAvgLap.textContent = formatTime(avgLapTime);
            summaryAvgNet.textContent = formatTime(avgNetTime);
            summaryMaxLap.textContent = formatTime(maxLapTime);
            summaryMinLap.textContent = formatTime(minLapTime);
            summaryPauseCount.textContent = pauseCount;
            summaryTotalPause.textContent = formatTime(totalPauseTime);
            summaryNetTotal.textContent = formatTime(netTotalTime);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ –∏—Ç–æ–≥–æ–≤
            summary.style.display = 'block';
        }
        
        // –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8
        function exportLogsToFile() {
            if (actionLogs.length === 0) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º BOM –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è UTF-8
            const BOM = '\uFEFF';
            
            // –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –ª–æ–≥–æ–≤
            let logContent = BOM + "–°–µ–∫—É–Ω–¥–æ–º–µ—Ä –¥–ª—è —ç–≤–µ—Ä–µ—Å—Ç–∏–Ω–≥–∞ - –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π\n";
            logContent += "==========================================\n\n";
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ
            logContent += `–§–∞–π–ª —Å–æ–∑–¥–∞–Ω: ${new Date().toLocaleString('ru-RU')}\n`;
            logContent += `–ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF-8\n`;
            logContent += "------------------------------------------\n\n";
            
            // –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π
            logContent += "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π:\n";
            logContent += "–í—Ä–µ–º—è\t\t\t–î–µ–π—Å—Ç–≤–∏–µ\t\t–î–µ—Ç–∞–ª–∏\t\t–û–±—â–µ–µ –≤—Ä–µ–º—è\t–ö—Ä—É–≥\t–ü–∞—É–∑–∞\n";
            logContent += "--------------------------------------------------------------------------------\n";
            
            actionLogs.forEach(log => {
                logContent += `${formatDateTime(log.timestamp)}\t${log.action}\t\t${log.details}\t\t`;
                logContent += `${formatTime(log.totalTime)}\t${formatTime(log.lapTime)}\t${formatTime(log.pauseTime)}\n`;
            });
            
            logContent += "\n\n";
            
            // –î–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
            logContent += "–î–∞–Ω–Ω—ã–µ –ø–æ –∫—Ä—É–≥–∞–º:\n";
            logContent += "–ö—Ä—É–≥\t–í—Ä–µ–º—è –∫—Ä—É–≥–∞\t–ü–∞—É–∑–∞\t–ß–∏—Å—Ç–æ–µ –≤—Ä–µ–º—è\t–û–±—â–µ–µ –≤—Ä–µ–º—è\t–í—Ä–µ–º—è —Ñ–∏–∫—Å–∞—Ü–∏–∏\n";
            logContent += "------------------------------------------------------------------------\n";
            
            lapsData.forEach(lap => {
                logContent += `${lap.lapNumber}\t${formatTime(lap.lapTime)}\t${formatTime(lap.pauseTime)}\t`;
                logContent += `${formatTime(lap.netTime)}\t${formatTime(lap.totalTime)}\t${formatDateTime(lap.timestamp)}\n`;
            });
            
            logContent += "\n";
            
            // –ò—Ç–æ–≥–∏
            logContent += "–ò—Ç–æ–≥–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:\n";
            logContent += "----------------------------------------\n";
            logContent += `–û–±—â–µ–µ –≤—Ä–µ–º—è: ${summaryTotalTime.textContent}\n`;
            logContent += `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—É–≥–æ–≤: ${summaryLapCount.textContent}\n`;
            logContent += `–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∫—Ä—É–≥–∞: ${summaryAvgLap.textContent}\n`;
            logContent += `–°—Ä–µ–¥–Ω–µ–µ —á–∏—Å—Ç–æ–µ –≤—Ä–µ–º—è: ${summaryAvgNet.textContent}\n`;
            logContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∫—Ä—É–≥–∞: ${summaryMaxLap.textContent}\n`;
            logContent += `–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∫—Ä—É–≥–∞: ${summaryMinLap.textContent}\n`;
            logContent += `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—É–∑: ${summaryPauseCount.textContent}\n`;
            logContent += `–°—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è –ø–∞—É–∑: ${summaryTotalPause.textContent}\n`;
            logContent += `–ß–∏—Å—Ç–æ–µ –æ–±—â–µ–µ –≤—Ä–µ–º—è: ${summaryNetTotal.textContent}\n`;
            
            // –°–æ–∑–¥–∞–µ–º blob —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–¥–∏—Ä–æ–≤–∫–∏ UTF-8
            const blob = new Blob([logContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `everesting_log_${new Date().toISOString().slice(0, 10)}_${new Date().getHours()}${new Date().getMinutes()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ —Ñ–∏–Ω–∏—à–∞
        function handleFinishClick() {
            if (!isRunning) return;
            
            finishClickCount++;
            
            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ —Ñ–∏–Ω–∏—à–∞
            addLog('–ü–û–ü–´–¢–ö–ê –§–ò–ù–ò–®–ê', `–ù–∞–∂–∞—Ç–∏–µ ${finishClickCount}/3`);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            finishIndicator.style.display = 'block';
            finishCountDisplay.textContent = 3 - finishClickCount;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
            clearTimeout(finishClickTimer);
            clearTimeout(finishIndicatorTimeout);
            
            // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ —Ç—Ä–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
            if (finishClickCount >= 3) {
                addLog('–§–ò–ù–ò–®', '–£—Å–ø–µ—à–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ç—Ä–æ–π–Ω—ã–º –Ω–∞–∂–∞—Ç–∏–µ–º');
                finishTimers();
                return;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–±—Ä–æ—Å–∞ —Å—á–µ—Ç—á–∏–∫–∞
            finishClickTimer = setTimeout(() => {
                addLog('–§–ò–ù–ò–®', '–¢–∞–π–º–∞—É—Ç - —Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ –Ω–∞–∂–∞—Ç–∏–π');
                finishClickCount = 0;
                finishIndicator.style.display = 'none';
            }, 1000);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
            finishIndicatorTimeout = setTimeout(() => {
                finishIndicator.style.display = 'none';
            }, 1000);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ —Å–±—Ä–æ—Å–∞
        function handleResetClick() {
            if (isRunning) return;
            
            resetClickCount++;
            
            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–±—Ä–æ—Å–∞
            addLog('–ü–û–ü–´–¢–ö–ê –°–ë–†–û–°–ê', `–ù–∞–∂–∞—Ç–∏–µ ${resetClickCount}/3`);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            resetIndicator.style.display = 'block';
            resetCountDisplay.textContent = 3 - resetClickCount;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
            clearTimeout(resetClickTimer);
            clearTimeout(resetIndicatorTimeout);
            
            // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ —Ç—Ä–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
            if (resetClickCount >= 3) {
                addLog('–°–ë–†–û–°', '–£—Å–ø–µ—à–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ç—Ä–æ–π–Ω—ã–º –Ω–∞–∂–∞—Ç–∏–µ–º');
                resetTimers();
                return;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–±—Ä–æ—Å–∞ —Å—á–µ—Ç—á–∏–∫–∞
            resetClickTimer = setTimeout(() => {
                addLog('–°–ë–†–û–°', '–¢–∞–π–º–∞—É—Ç - —Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ –Ω–∞–∂–∞—Ç–∏–π');
                resetClickCount = 0;
                resetIndicator.style.display = 'none';
            }, 1000);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
            resetIndicatorTimeout = setTimeout(() => {
                resetIndicator.style.display = 'none';
            }, 1000);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö —Å–µ–∫—É–Ω–¥–æ–º–µ—Ä–æ–≤
        function finishTimers() {
            isRunning = false;
            isPaused = false;
            
            // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
            clearInterval(totalInterval);
            clearInterval(lapInterval);
            clearInterval(pauseInterval);
            clearTimeout(finishClickTimer);
            clearTimeout(finishIndicatorTimeout);
            
            // –§–∏–∫—Å–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫—Ä—É–≥–∞, –µ—Å–ª–∏ —Ç–∞–π–º–µ—Ä –±—ã–ª –∑–∞–ø—É—â–µ–Ω
            if (lapCount > 0 && lapElapsed > 0) {
                recordLap();
            }
            
            // –†–∞—Å—á–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤
            calculateSummary();
            
            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            addLog('–ó–ê–í–ï–†–®–ï–ù–ò–ï', `–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ö—Ä—É–≥–æ–≤: ${lapCount}, –û–±—â–µ–µ –≤—Ä–µ–º—è: ${formatTime(totalElapsed)}`);
            
            // –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª —Å UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
            exportLogsToFile();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
            totalStatus.className = 'status-dot stopped';
            lapStatus.className = 'status-dot stopped';
            pauseStatus.className = 'status-dot stopped';
            
            // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫
            btnStart.disabled = true;
            btnPause.disabled = true;
            btnFinish.disabled = true;
            btnReset.disabled = false;
            
            // –°–±—Ä–æ—Å —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–æ–∫
            btnStart.textContent = '–ü—É—Å–∫/–∫—Ä—É–≥';
            btnStart.classList.remove('active');
            btnPause.classList.remove('active');
            btnFinish.classList.remove('pressed');
            
            // –°–∫—Ä—ã—Ç–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Ñ–∏–Ω–∏—à–∞
            finishIndicator.style.display = 'none';
            finishClickCount = 0;
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞
        function resetTimers() {
            // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
            clearInterval(totalInterval);
            clearInterval(lapInterval);
            clearInterval(pauseInterval);
            clearTimeout(finishClickTimer);
            clearTimeout(finishIndicatorTimeout);
            clearTimeout(resetClickTimer);
            clearTimeout(resetIndicatorTimeout);
            
            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–±—Ä–æ—Å–∞
            addLog('–ü–û–õ–ù–´–ô –°–ë–†–û–°', '–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
            
            // –°–±—Ä–æ—Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
            startTime = 0;
            lapStartTime = 0;
            pauseStartTime = 0;
            totalElapsed = 0;
            lapElapsed = 0;
            pauseElapsed = 0;
            isRunning = false;
            isPaused = false;
            lapCount = 0;
            finishClickCount = 0;
            resetClickCount = 0;
            lapsData = [];
            actionLogs = []; // –û—á–∏—â–∞–µ–º –ª–æ–≥–∏ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏—Å–ø–ª–µ–µ–≤
            updateDisplays();
            
            // –û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
            resultsBody.innerHTML = '';
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
            totalStatus.className = 'status-dot stopped';
            lapStatus.className = 'status-dot stopped';
            pauseStatus.className = 'status-dot stopped';
            
            // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫
            btnStart.disabled = false;
            btnPause.disabled = true;
            btnFinish.disabled = true;
            btnReset.disabled = true;
            
            // –°–±—Ä–æ—Å —Ç–µ–∫—Å—Ç–∞ –∏ —Å—Ç–∏–ª–µ–π –∫–Ω–æ–ø–æ–∫
            btnStart.textContent = '–ü—É—Å–∫/–∫—Ä—É–≥';
            btnStart.classList.remove('active');
            btnPause.classList.remove('active');
            btnFinish.classList.remove('pressed');
            
            // –°–∫—Ä—ã—Ç–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ –∏—Ç–æ–≥–æ–≤
            finishIndicator.style.display = 'none';
            resetIndicator.style.display = 'none';
            summary.style.display = 'none';
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫
        btnStart.addEventListener('click', startTimers);
        
        btnPause.addEventListener('click', togglePause);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –§–∏–Ω–∏—à —Å —Ç—Ä–æ–π–Ω—ã–º –Ω–∞–∂–∞—Ç–∏–µ–º
        btnFinish.addEventListener('click', handleFinishClick);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –°–±—Ä–æ—Å —Å —Ç—Ä–æ–π–Ω—ã–º –Ω–∞–∂–∞—Ç–∏–µ–º
        btnReset.addEventListener('click', handleResetClick);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
        toggleInstructions.addEventListener('click', function() {
            instructions.classList.toggle('hidden');
            addLog('–ò–ù–°–¢–†–£–ö–¶–ò–Ø', instructions.classList.contains('hidden') ? '—Å–∫—Ä—ã—Ç–∞' : '–ø–æ–∫–∞–∑–∞–Ω–∞');
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateDisplays();
        instructions.classList.add('hidden');
        addLog('–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø', '–°–µ–∫—É–Ω–¥–æ–º–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
    </script>
    <!-- –í –∫–æ–Ω–µ—Ü <body> -->
<div style="position: fixed; top: 10px; right: 10px; background: #ffeb3b; padding: 8px; border-radius: 4px; z-index: 9999; font-weight: bold;">
  üöÄ –í–µ—Ä—Å–∏—è: main
</div>
</body>
</html>
